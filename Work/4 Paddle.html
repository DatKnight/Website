<canvas width = "700" height = "350" id = "canvas"></canvas>

<script>

var c = document.getElementById("canvas");
var cc = c.getContext("2d");

var width = document.getElementById("canvas").getAttribute("width");
var height = document.getElementById("canvas").getAttribute("height");;

var ball = [width/2,height/2,0,0];
paddles = [0,0]
psize = 40
var mx = 0
var my = 0

var score = 0;
var time = 0;
var count = 0;
var debug = false;
var lost = false;
var main = true;
var bot = true;

window.onload = function(){
	setInterval(update,1000/60);
	c.addEventListener("mousemove",function(event){
		mx = event.clientX;
		my = event.clientY;

		if(mx < 25){ mx = 25; }
		if(my < 25){ my = 25; }
		if(mx > width - 25){ mx = width - 25; }
		if(my > height - 25){ my = height - 25;}

		paddles = [mx,my];
	});

	c.addEventListener("click",function(event){
		randomVelocity();
	});
}



function update(){
	drawBack();
	checkBot();
	if(main == true){
		mainMenu();
	}
	else {
		drawScore();
		drawBall();
		drawPlayer();
		drawTime();

		applyVelocity();
		checkTime();
		detectCollision()
		count++
	}


	if(debug == true){
		drawInfo();
	}

}

function drawBack(){
	cc.fillStyle = "black";
	cc.fillRect(0,0,width,height);
}

function drawInfo(){
	cc.fillStyle = "white";
	cc.font = "10px sans-serif";
	cc.fillText("mx: " + mx,mx + 5,my + 20);
	cc.fillText("my: " + my,mx + 5,my + 30);
	cc.fillText("vx: " + ball[2],5,30);
	cc.fillText("vy: " + ball[3],5,40);
	cc.fillText("ax: " + ball[4],5,50);
	cc.fillText("ay: " + ball[5],5,60);
	cc.fillText("x: " + ball[0],ball[0] + 5,ball[1] + 20);
}

function drawScore(){
	cc.fillStyle = "white";
	cc.font = "10px sans-serif";
	cc.fillText("Score: " + score,5,10);
}

function drawTime(){
	min = Math.floor(time / 60);
	sec = time - (min * 60);

	if(min < 10){min = "0" + min}
	if(sec < 10){sec = "0" + sec}

	cc.fillStyle = "white";
	cc.font = "10px sans-serif";
	cc.fillText("Time: " + min + ":" + sec,5,20);
}

function drawBall(){
	cc.fillStyle = "white";
	cc.fillRect(ball[0] - 5,ball[1] - 5,10,10);
}

function drawPlayer(){
	cc.fillStyle = "white";
	cc.fillRect(paddles[0] - (psize/2),5,psize,10);
	cc.fillRect(paddles[0] - (psize/2),height - 15,psize,10);
	cc.fillRect(5,paddles[1] - (psize/2),10,psize);
	cc.fillRect(width - 15,paddles[1] - (psize/2),10,psize);
}


function gameOver(){
	cc.fillStyle = "white";
	cc.font = "40px sans-serif";
	cc.fillText("Game Over",200,250);
	cc.font = "20px sans-serif";
	cc.fillText("Continue",260,350);
}

function mainMenu(){
	cc.fillStyle = "white";
	cc.font = "40px sans-serif";
	cc.fillText("4 Paddle Pong",(width/2) - 160,(height/2) - 50);
	cc.font = "20px sans-serif";
	cc.fillText("Start",(width/2) - 40,(height/2) + 50);
	if(mx >= (width/2) - 30 && mx <= (width/2) + 10){
		if(my >= (height/2) + 40 && my <= (height/2) + 60){
			main = false;
		}
	}
}

function checkTime(){
	if(count == 60){
		time++;
		count = 0;

	}
}

function checkScore(){
	if(score % 5 == 0 && score > 0){
		x = Math.random();
		if(x < 1/3){speedUp(2);}
		if(x > 1/3 && x < 2/3 ){speedUp(3);}
		if(x > 2/3){
			speedUp(2);
			speedUp(3);
		}
	}
}

function speedUp(x){
	if(ball[x] > 0 && ball[x] <= 15){ball[x] += 0.5;}
	if(ball[x] < 0 && ball[x] >= -15){ball[x] -= 0.5;}
}

function randomVelocity(){
	if(score == 0 && main == false){
		x = Math.random();
		y = Math.random();
		if(x < 0.5){
			ball[2] = -1
		}
		else {
			ball[2] = 1
		}
		if(y < 0.5){
			ball[3] = -1
		}
		else{
			ball[3] = 1
		}
	}
}

function reset(){
	score = 0;
	ball = [width/2,height/2,0,0];
	lost = false;
	count = 0;
	time = 0;
}


function detectCollision(){
	ballx = ball[0];
	bally = ball[1];
	px = paddles[0];
	py = paddles[1];
	if(ballx >= width - 20 || ballx <= 20){
		if(bally >= py - (psize/2) && bally <= py + (psize/2)){
			reflectx();
			score++
			checkScore();
		}
		else{
			reset();
		}
	}

	if(bally >= height - 20 || bally <= 20){
		if(ballx >= px - (psize/2) && ballx <= px + (psize/2)){
			reflecty();
			score++
			checkScore();
		}
		else{
			reset();
		}
	}
}

function reflectx(){
	ball[2] = ball[2] * -1;

}

function reflecty(){
	ball[3] = ball[3] * -1
}

function applyVelocity(){
	ballx = ball[0];
	bally = ball[1];
	if(ballx == 0 + 11 || ballx == 600 - 11){
		ball[0] = 0;
	}
	if(bally == 0 + 11 || bally == 600 - 11){
		ball[1] = 0;
	}
	else {
		ball[0] = ballx + ball[2];
		ball[1] = bally + ball[3];
	}
}

function toggleDebug(){
	if(debug == true){
		debug = false;
	}
	else{
		debug = true;
	}
}

function checkBot(){
	if(bot == true){
		paddles[0] = ball[0];
		paddles[1] = ball[1];
		if(paddles[0] < 25){ paddles[0] = 25; }
		if(paddles[1] < 25){ paddles[1] = 25; }
		if(paddles[0] > width - 25){ paddles[0] = width - 25; }
		if(paddles[1] > height - 25){ paddles[1] = height - 25;}
	}
}

</script>
<body>
	<br>
	<script src="Javascript/javascript.js" type="text/javascript"></script>

	<div id="spoiler" style="display:none">
		dasdasdasd
	</div>

	<button type="button" title="Click to show/hide code" onclick="spoilerToggle('spoiler')">Show/Hide Code</button>

	<br>
	<a href="javascript:history.back()">Back</a>



</body>
